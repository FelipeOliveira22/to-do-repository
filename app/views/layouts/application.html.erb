<!DOCTYPE html>
<html lang="pt-BR" data-theme="custom360">
  <head>
    <title><%= content_for(:title) || "To Do List V2" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload", type: "module" %>

  </head>

  <body>
    <main class="container mx-auto mt-28 px-5 flex">
      <%= yield %>
    </main>

    <!-- Notificação de Sucesso -->
    <% if notice %>
      <div id="flash-notice" class="fixed bottom-0 left-1/2 transform -translate-x-1/2 mb-4 z-50 px-6 py-3 bg-green-500 text-white rounded-lg shadow-lg transition-all duration-500 opacity-100">
        <div class="flex items-center gap-2">
          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
          </svg>
          <%= notice %>
          <button onclick="dismissNotice()" class="ml-2 text-white hover:text-gray-200 focus:outline-none">
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </button>
        </div>
      </div>
    <% end %>

    <% if alert %>
      <div id="flash-alert" class="fixed bottom-0 left-1/2 transform -translate-x-1/2 mb-4 z-50 px-6 py-3 bg-red-500 text-white rounded-lg shadow-lg transition-all duration-500 opacity-100">
        <div class="flex items-center gap-2">
          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
          </svg>
          <%= alert %>
          <button onclick="dismissAlert()" class="ml-2 text-white hover:text-gray-200 focus:outline-none">
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </button>
        </div>
      </div>
    <% end %>

    <script>
      function dismissNotice() {
        const flash = document.getElementById("flash-notice");
        if (flash) {
          flash.classList.add("opacity-0", "translate-y-2");
          setTimeout(() => flash.remove(), 300);
        }
      }

      function dismissAlert() {
        const flash = document.getElementById("flash-alert");
        if (flash) {
          flash.classList.add("opacity-0", "translate-y-2");
          setTimeout(() => flash.remove(), 300);
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        const flashNotice = document.getElementById("flash-notice");
        if (flashNotice) {
          setTimeout(() => {
            flashNotice.classList.add("opacity-0", "translate-y-2");
            setTimeout(() => flashNotice.remove(), 500);
          }, 4000);
        }

        // Notificação de erro
        const flashAlert = document.getElementById("flash-alert");
        if (flashAlert) {
          setTimeout(() => {
            flashAlert.classList.add("opacity-0", "translate-y-2");
            setTimeout(() => flashAlert.remove(), 500);
          }, 5000); 
        }
      });

      document.addEventListener("turbo:load", function () {
        const flashNotice = document.getElementById("flash-notice");
        if (flashNotice) {
          setTimeout(() => {
            flashNotice.classList.add("opacity-0", "translate-y-2");
            setTimeout(() => flashNotice.remove(), 500);
          }, 4000);
        }

        const flashAlert = document.getElementById("flash-alert");
        if (flashAlert) {
          setTimeout(() => {
            flashAlert.classList.add("opacity-0", "translate-y-2");
            setTimeout(() => flashAlert.remove(), 500);
          }, 5000);
        }
      });

        (function() {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'light') {
      document.body.classList.add('light-theme');
    }
  })();

(function () {
  'use strict';

  function initializeTheme() {
    const savedTheme = localStorage.getItem('theme');
    const themeIcon = document.getElementById('theme-icon');
    if (!themeIcon) return;

    if (savedTheme === 'light') {
      document.body.classList.add('light-theme');
      themeIcon.classList.remove('fa-moon');
      themeIcon.classList.add('fa-sun');
    } else {
      document.body.classList.remove('light-theme');
      themeIcon.classList.remove('fa-sun');
      themeIcon.classList.add('fa-moon');
    }
  }

  window.toggleTheme = function () {
    const body = document.body;
    const themeIcon = document.getElementById('theme-icon');
    if (!themeIcon) return;

    if (body.classList.contains('light-theme')) {
      body.classList.remove('light-theme');
      themeIcon.classList.remove('fa-sun');
      themeIcon.classList.add('fa-moon');
      localStorage.setItem('theme', 'dark');
    } else {
      body.classList.add('light-theme');
      themeIcon.classList.remove('fa-moon');
      themeIcon.classList.add('fa-sun');
      localStorage.setItem('theme', 'light');
    }
  };

  window.deleteBoard = function (id) {
    if (!id) return;

    // Verifica se o modal já existe
    let modal = document.getElementById('confirm-modal');
    if (!modal) {
      modal = document.createElement('div');
      modal.id = 'confirm-modal';
      document.body.appendChild(modal);
    }

    // Estiliza diretamente via JS
    modal.style.position = 'fixed';
    modal.style.top = '0';
    modal.style.left = '0';
    modal.style.width = '100%';
    modal.style.height = '100%';
    modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
    modal.style.display = 'flex';
    modal.style.justifyContent = 'center';
    modal.style.alignItems = 'center';
    modal.style.zIndex = '9999';

    modal.innerHTML = `
      <div style="
        background: white;
        padding: 30px;
        border-radius: 12px;
        text-align: center;
        max-width: 400px;
        width: 90%;
        box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        font-family: 'Poppins', sans-serif;
      ">
        <h2 style="margin-bottom: 10px;">Confirmação</h2>
        <p style="margin-bottom: 25px; font-size: 16px; background: #e0e0e0; padding: 12px 16px; border-radius: 8px; color: #222;">
          Tem certeza que deseja excluir este board?
        </p>


        <div style="display: flex; justify-content: space-around;">
          <button id="confirm-yes" style="
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
          ">Sim, excluir</button>
          <button id="confirm-no" style="
            background: #e0e0e0;
            color: #333;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
          ">Cancelar</button>
        </div>
      </div>
    `;

    document.getElementById('confirm-yes').onclick = function () {
      fetch(`/boards/${id}`, {
        method: 'DELETE',
        headers: {
          'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
        }
      }).then(() => {
        location.reload();
      }).catch(err => {
        alert("Erro ao excluir board.");
        console.error(err);
      });
    };

    document.getElementById('confirm-no').onclick = function () {
      modal.remove();
    };
  };

  // Inicializar tema com Turbo + Turbolinks + fallback
  document.addEventListener('DOMContentLoaded', initializeTheme);
  document.addEventListener('turbolinks:load', initializeTheme);
  document.addEventListener('turbo:load', initializeTheme);
})();

    </script>

  </body>
</html>